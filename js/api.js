//
// pub.lagged.com/contact for support
//

function apiCall(a){var b=a.origin||a.originalEvent.origin;if("http://lagged.com"===b){var c;try{c=JSON.parse(a.data)}catch(a){c=null}if(c&&c.section){var d=c||{};d.section=c.section,d.action=c.action;var e=JSON.stringify(d),f=siteurl+"/api.php",g="type="+d.section+"&action="+d.action+"&data="+Encode.base64(e)+"&hash="+Encode.md5(e+"lgb8gb"),h=new XMLHttpRequest;h.onreadystatechange=function(){if(4==h.readyState)if(200==h.status){var a=h.responseText;a=a.replace(")]}',",""),a=JSON.parse(a),a.data&&(a.success=!0),"scores"==c.section?showBoard(c,a):showAward(a)}else console.log(error)},h.open("POST",f,!0),h.setRequestHeader("Content-type","application/x-www-form-urlencoded"),h.send(g)}}}var showBoard=function(a,b){var c='<div id="hs_board_wrap">',d="Friends";if(1==b.data.login){c+='<div class="hs_main_wrap guest">';var d="Sign up"}else c+='<div class="hs_main_wrap">';c+='<div class="hs_main_top"><a href="'+siteurl+"/g/"+b.data.gamedata.url_key+'" target="_blank"><img src="'+siteurl+"/thumbs/"+b.data.gamedata.thumb+'" alt="game" /></a><div class="hs_game_title"><h1>'+b.data.gamedata.name+'</h1><h3><a id="topboard" class="boardlink active" onClick="loadTab(0)">'+b.data.gamedata.bname+'</a><a id="frnboard" class="boardlink" onClick="loadTab(1)">'+d+'</a></h3></div><button onclick="closeThisHS()"></button></div><div class="hs_main_center">';for(var h,e=0,f=0,g=0,i=0,j=b.data.scoredata.length;i<j;i++){if(0==i){c+='<div class="hs_main_userscore firstscore">';var k=b.data.scoredata[0].avatar?b.data.scoredata[0].avatar:"default-avatar.jpg";h='<img src="'+siteurl+"/images/avatars/"+k+'" alt="avatar" />'}else c+='<div class="hs_main_userscore">',h="";var l=parseInt(b.data.scoredata[i].scores);f++,l!=g&&(g=l,e=f),c+='<div class="userscore_name"><a href="'+siteurl+"/profile/"+b.data.scoredata[i].uid+'" target="_blank">'+h+"<span>#"+e+"</span> "+b.data.scoredata[i].username+'</a></div><div class="userscore_score">'+numberWithCommas(l)+'</div><div class="userscore_time">'+timeSince(b.data.scoredata[i].timestamped)+" ago</div></div>"}c+='</div><div class="hs_main_footer">',1==b.data.login?c+='<div class="login_please"><div class="guest_score">'+numberWithCommas(a.score)+'</div><div class="login_txt">Sign up to submit your score</div><div class="login_awrap"><a class="signup" onClick="loadTab(1)">Submit Score</a></div><div class="guest_social_share"><a href="https://www.facebook.com/dialog/share?app_id='+facebookapp+"&display=popup&href="+encodeURI(siteurl)+"%2Fg%2F"+encodeURI(b.data.gamedata.url_key)+"&redirect_uri="+encodeURI(siteurl)+"%2Fg%2F"+encodeURI(b.data.gamedata.url_key)+'" class="facebook" target="_blank">Facebook</a><a href="https://twitter.com/home?status=I%20just%20scored%20'+a.score+"%20at%20"+encodeURI(b.data.gamedata.name)+".%20Try%20to%20beat%20my%20score%3A%20"+encodeURI(siteurl)+"%2Fg%2F"+encodeURI(b.data.gamedata.url_key)+'" class="twitter" target="_blank">Twitter</a></div></div>':(c+='<div class="user_top_score"><div class="yourtop">Your top score:</div><div class="hs_main_userscore"><div class="userscore_name"><a href="'+siteurl+"/profile/"+b.data.gamedata.uid+'" target="_blank"><span>#'+b.data.utop.rank+"</span> "+b.data.gamedata.username+'</a></div><div class="userscore_score">'+numberWithCommas(b.data.utop.score)+'</div></div><div class="guest_social_share"><a href="https://www.facebook.com/dialog/share?app_id='+facebookapp+"&display=popup&href="+encodeURI(siteurl)+"%2Fg%2F"+encodeURI(b.data.gamedata.url_key)+"&redirect_uri=http%3A%2F%2Flagged.com%2Fen%2Fg%2F"+encodeURI(b.data.gamedata.url_key)+'" class="facebook" target="_blank">Facebook</a><a href="https://twitter.com/home?status=Can%20you%20beat%20my%20top%20score%20of%20'+b.data.utop.score+"%20at%20"+encodeURI(b.data.gamedata.name)+"%20"+encodeURI(siteurl)+"%2Fg%2F"+encodeURI(b.data.gamedata.url_key)+'" class="twitter" target="_blank">Twitter</a></div></div>',c+='<a href="http://lagged.com/" target="_blank" class="logo"></a>'),c+="</div>",c+='<div id="frnd_leaderboard">';var h,e=0,f=0,g=0;if(1==b.data.login)c+='<p id="msgblock"></p><form id="loginit" onSubmit="createAccount();return false;">',c+='<div class="form-group">',c+='<label for="exampleInputEmail1">Nickname</label>',c+='<input autofocus type="text" name="name" value="" class="form-control" id="exampleInputEmail1" placeholder="Nickname" required>',c+="</div>",c+='<div class="form-group">',c+='<label for="exampleInputEmail2">Email address (verification required)</label>',c+='<input type="email" name="email" value="" class="form-control" id="exampleInputEmail2" placeholder="Valid Email" required>',c+="</div>",c+='<div class="form-group">',c+='<label for="exampleInputEmail3">Password</label>',c+='<input type="password" class="form-control" id="exampleInputEmail3" name="password" placeholder="Password: At least 6 characters" autocomplete="off" required>',c+="</div>",c+='<button class="btn btn-full btn-bigtxt" onClick="createAccount();return false;">Create account</button></form>';else{for(var i=0,j=b.data.frndboard.length;i<j;i++){if(0==i){c+='<div class="hs_main_userscore firstscore">';var k=b.data.frndboard[0].avatar?b.data.frndboard[0].avatar:"default-avatar.jpg";h='<img src="'+siteurl+"/images/avatars/"+k+'" alt="avatar" />'}else c+='<div class="hs_main_userscore">',h="";var l=parseInt(b.data.frndboard[i].scores);f++,l!=g&&(g=l,e=f),c+='<div class="userscore_name"><a href="'+siteurl+"/profile/"+b.data.frndboard[i].uid+'" target="_blank">'+h+"<span>#"+e+"</span> "+b.data.frndboard[i].username+'</a></div><div class="userscore_score">'+numberWithCommas(l)+'</div><div class="userscore_time">'+timeSince(b.data.frndboard[i].timestamped)+" ago</div></div>"}c+='<div class="invitefriends"><a href="'+siteurl+'/invite" class="signup" target="_blank">Invite your friends</a></div>'}c+="</div></div>";var m=create(c);document.body.insertBefore(m,document.body.childNodes[0])},showAward=function(a){if(console.log(a),1==a.data.show){var b;b=1==a.data.login?"login":"awards";var c=create('<div id="removeelement" class="achievement fadeout"><a href="'+siteurl+"/"+b+'" target="_blank"><img src="'+siteurl+'/images/award-unlocked.png" width="44" height="44" /><div><h3>Award unlocked</h3><p>'+a.data.achdata.name+'</p></div><div class="bittoearn">+'+a.data.achdata.points+"<span>xp</span></div></a></div>");document.body.insertBefore(c,document.body.childNodes[0]);for(var d=0,e=a.data.aid.length;d<e;d++)document.getElementById(a.data.aid[d]).className="awards_bit";setTimeout(function(){var a=document.getElementById("removeelement");a.parentNode.removeChild(a)},4800)}},submitinprogress=!1,createAccount=function(){if(submitinprogress)return!1;var b,a=!1,c=document.getElementById("exampleInputEmail1").value,d=document.getElementById("exampleInputEmail2").value,e=document.getElementById("exampleInputEmail3").value;if(!d||d.length<6?(a=!0,b="Email must be valid"):!c||c.length<2?(a=!0,b="Nickname must be 2 or more characters"):(!e||e.length<6)&&(a=!0,b="Password must be 6 or more characters"),a)document.getElementById("msgblock").style.display="block",document.getElementById("msgblock").innerHTML="Error: "+b;else{submitinprogress=!0;var f="<div class='hourglass' id='loadinggif'>loading...</div>",g=create(f);document.body.insertBefore(g,document.body.childNodes[0]);var h=h||{};h.email=d,h.name=c,h.password=e;var i=JSON.stringify(h),j="action=signup&data="+Encode.base64(i),k=new XMLHttpRequest;k.onreadystatechange=function(){if(4==k.readyState)if(200==k.status){var b=k.responseText;b=b.replace(")]}',",""),b=JSON.parse(b);var c=document.getElementById("loadinggif");if(c.parentNode.removeChild(c),b.success&&!b.errors){var d="<div id='successmsglogin'>";d+="<h1>Welcome!</h1>",d+="<h3>Your score has been saved. <a href='"+siteurl+"/profile/"+b.uid+"' target='_blank'>View your profile</a></h3>",d+="<button onClick='closeThisHS()' class='btn btn-full'>Continue Playing</button>",d+="</div>",document.getElementById("hs_board_wrap").innerHTML+=d}else submitinprogress=!1,document.getElementById("msgblock").style.display="block",document.getElementById("msgblock").innerHTML="Error: "+b.errors}else{submitinprogress=!1;var c=document.getElementById("loadinggif");c.parentNode.removeChild(c),document.getElementById("msgblock").style.display="block",document.getElementById("msgblock").innerHTML="Error: "+a}},k.open("POST",siteurl+"/json.php?"+j,!0),k.setRequestHeader("Content-type","application/x-www-form-urlencoded"),k.send(j)}},loadTab=function(a){0==a?(document.getElementById("frnd_leaderboard").style.display="none",document.getElementById("topboard").classList.add("active"),document.getElementById("frnboard").classList.remove("active")):(document.getElementById("frnd_leaderboard").style.display="block",document.getElementById("frnboard").classList.add("active"),document.getElementById("topboard").classList.remove("active"))};window.addEventListener("message",apiCall,!1);var create=function(a){var b=document.createDocumentFragment(),c=document.createElement("div");for(c.innerHTML=a;c.firstChild;)b.appendChild(c.firstChild);return b};showMenu=function(){var a=document.getElementById("menu");a.classList.toggle("showithideit");var b=document.getElementById("mainbtn");b.classList.toggle("sliderlef")},showWalkthrough=function(){veedimute=!veedimute;var a=document.getElementById("videomenu");a.classList.toggle("thisishidden");if(veedimute){_v.mute();}else{ _v.unmute();}},showAwards=function(){var a=document.getElementById("awards_menu");a.classList.toggle("showithideit");var b=document.getElementById("awardbtn");b.classList.toggle("sliderlef")};var closeThisHS=function(){var a=document.getElementById("hs_board_wrap");a.parentNode.removeChild(a)};Element.prototype.remove=function(){this.parentElement.removeChild(this)},NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var a=this.length-1;a>=0;a--)this[a]&&this[a].parentElement&&this[a].parentElement.removeChild(this[a])};var numberWithCommas=function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},convertToServerTimeZone=function(){return offset=-7,clientDate=new Date,utc=clientDate.getTime()+6e4*clientDate.getTimezoneOffset(),serverDate=new Date(utc+36e5*offset),serverDate},timeSince=function(a){var b,c=a.split(/[- :]/),d=new Date(c[0],c[1]-1,c[2],c[3],c[4],c[5]),e=convertToServerTimeZone(),f=Math.floor((e-d)/1e3),g=Math.floor(f/31536e3);return g>=1?b="year":(g=Math.floor(f/2592e3),g>=1?b="month":(g=Math.floor(f/86400),g>=1?b="day":(g=Math.floor(f/3600),g>=1?b="hour":(g=Math.floor(f/60),g>=1?b="minute":(g=Math.abs(f),b="second"))))),(g>1||0===g)&&(b+="s"),g+" "+b},Encode=new function(){function a(a){if(!a)return"";a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}function b(a,b){var c=1&a|1&b,d=a>>>1|b>>>1;return d<<1|c}function c(a,b){var c=1&a^1&b,d=a>>>1^b>>>1;return d<<1|c}function d(a,b){var c=1&a&(1&b),d=a>>>1&b>>>1;return d<<1|c}function e(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function f(a){var b,c="";for(b=0;b<=3;b++)c+=o.charAt(a>>8*b+4&15)+o.charAt(a>>8*b&15);return c}function g(a){var b,c=(a.length+8>>6)+1,d=new Array(16*c);for(b=0;b<16*c;b++)d[b]=0;for(b=0;b<a.length;b++)d[b>>2]|=a.charCodeAt(b)<<(8*a.length+b)%4*8;d[b>>2]|=128<<(8*a.length+b)%4*8;var e=8*a.length;return d[16*c-2]=255&e,d[16*c-2]|=(e>>>8&255)<<8,d[16*c-2]|=(e>>>16&255)<<16,d[16*c-2]|=(e>>>24&255)<<24,d}function h(a,b){return a<<b|a>>>32-b}function i(a,b,c,d,f,g){return e(h(e(e(b,a),e(d,g)),f),c)}function j(a,c,e,f,g,h,j){return i(b(d(c,e),d(~c,f)),a,c,g,h,j)}function k(a,c,e,f,g,h,j){return i(b(d(c,f),d(e,~f)),a,c,g,h,j)}function l(a,b,d,e,f,g,h){return i(c(c(b,d),e),a,b,f,g,h)}function m(a,d,e,f,g,h,j){return i(c(e,b(d,~f)),a,d,g,h,j)}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="0123456789abcdef";return{base64:function(b){var c,d,e,f,g,h,i,j="",k=0;for(b=a(b);k<b.length;)c=b.charCodeAt(k++),d=b.charCodeAt(k++),e=b.charCodeAt(k++),f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?h=i=64:isNaN(e)&&(i=64),j=j+n.charAt(f)+n.charAt(g)+n.charAt(h)+n.charAt(i);return j},md5:function(a){for(var b=g(a),c=1732584193,d=-271733879,h=-1732584194,i=271733878,n=0;n<b.length;n+=16){var o=c,p=d,q=h,r=i;c=j(c,d,h,i,b[n+0],7,-680876936),i=j(i,c,d,h,b[n+1],12,-389564586),h=j(h,i,c,d,b[n+2],17,606105819),d=j(d,h,i,c,b[n+3],22,-1044525330),c=j(c,d,h,i,b[n+4],7,-176418897),i=j(i,c,d,h,b[n+5],12,1200080426),h=j(h,i,c,d,b[n+6],17,-1473231341),d=j(d,h,i,c,b[n+7],22,-45705983),c=j(c,d,h,i,b[n+8],7,1770035416),i=j(i,c,d,h,b[n+9],12,-1958414417),h=j(h,i,c,d,b[n+10],17,-42063),d=j(d,h,i,c,b[n+11],22,-1990404162),c=j(c,d,h,i,b[n+12],7,1804603682),i=j(i,c,d,h,b[n+13],12,-40341101),h=j(h,i,c,d,b[n+14],17,-1502002290),d=j(d,h,i,c,b[n+15],22,1236535329),c=k(c,d,h,i,b[n+1],5,-165796510),i=k(i,c,d,h,b[n+6],9,-1069501632),h=k(h,i,c,d,b[n+11],14,643717713),d=k(d,h,i,c,b[n+0],20,-373897302),c=k(c,d,h,i,b[n+5],5,-701558691),i=k(i,c,d,h,b[n+10],9,38016083),h=k(h,i,c,d,b[n+15],14,-660478335),d=k(d,h,i,c,b[n+4],20,-405537848),c=k(c,d,h,i,b[n+9],5,568446438),i=k(i,c,d,h,b[n+14],9,-1019803690),h=k(h,i,c,d,b[n+3],14,-187363961),d=k(d,h,i,c,b[n+8],20,1163531501),c=k(c,d,h,i,b[n+13],5,-1444681467),i=k(i,c,d,h,b[n+2],9,-51403784),h=k(h,i,c,d,b[n+7],14,1735328473),d=k(d,h,i,c,b[n+12],20,-1926607734),c=l(c,d,h,i,b[n+5],4,-378558),i=l(i,c,d,h,b[n+8],11,-2022574463),h=l(h,i,c,d,b[n+11],16,1839030562),d=l(d,h,i,c,b[n+14],23,-35309556),c=l(c,d,h,i,b[n+1],4,-1530992060),i=l(i,c,d,h,b[n+4],11,1272893353),h=l(h,i,c,d,b[n+7],16,-155497632),d=l(d,h,i,c,b[n+10],23,-1094730640),c=l(c,d,h,i,b[n+13],4,681279174),i=l(i,c,d,h,b[n+0],11,-358537222),h=l(h,i,c,d,b[n+3],16,-722521979),d=l(d,h,i,c,b[n+6],23,76029189),c=l(c,d,h,i,b[n+9],4,-640364487),i=l(i,c,d,h,b[n+12],11,-421815835),h=l(h,i,c,d,b[n+15],16,530742520),d=l(d,h,i,c,b[n+2],23,-995338651),c=m(c,d,h,i,b[n+0],6,-198630844),i=m(i,c,d,h,b[n+7],10,1126891415),h=m(h,i,c,d,b[n+14],15,-1416354905),d=m(d,h,i,c,b[n+5],21,-57434055),c=m(c,d,h,i,b[n+12],6,1700485571),i=m(i,c,d,h,b[n+3],10,-1894986606),h=m(h,i,c,d,b[n+10],15,-1051523),d=m(d,h,i,c,b[n+1],21,-2054922799),c=m(c,d,h,i,b[n+8],6,1873313359),i=m(i,c,d,h,b[n+15],10,-30611744),h=m(h,i,c,d,b[n+6],15,-1560198380),d=m(d,h,i,c,b[n+13],21,1309151649),c=m(c,d,h,i,b[n+4],6,-145523070),i=m(i,c,d,h,b[n+11],10,-1120210379),h=m(h,i,c,d,b[n+2],15,718787259),d=m(d,h,i,c,b[n+9],21,-343485551),c=e(c,o),d=e(d,p),h=e(h,q),i=e(i,r)}return f(c)+f(d)+f(h)+f(i)}}};

